<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="
                     http://www.liquibase.org/xml/ns/dbchangelog
                     http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

  <!-- Secuencia si no existe -->
  <changeSet id="019a-seq-boleta-numero" author="sgbd" context="!admin">
    <preConditions onFail="MARK_RAN">
      <not><sequenceExists sequenceName="SEQ_BOLETA_NUMERO"/></not>
    </preConditions>
    <createSequence sequenceName="SEQ_BOLETA_NUMERO" startValue="1" incrementBy="1" cacheSize="20"/>
    <rollback>
      <dropSequence sequenceName="SEQ_BOLETA_NUMERO"/>
    </rollback>
  </changeSet>

  <!-- Trigger si no existe -->
  <changeSet id="019b-trg-boleta-set-numero" author="sgbd" context="!admin">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        SELECT COUNT(*) FROM user_triggers WHERE trigger_name = 'TRG_BOLETA_SET_NUMERO'
      </sqlCheck>
    </preConditions>
    <sql>
      CREATE OR REPLACE TRIGGER TRG_BOLETA_SET_NUMERO
      BEFORE INSERT ON boleta_venta
      FOR EACH ROW
      WHEN (NEW.numero IS NULL)
      BEGIN
        :NEW.numero := SEQ_BOLETA_NUMERO.NEXTVAL;
      END;
    </sql>
    <rollback>
      <sql>DROP TRIGGER TRG_BOLETA_SET_NUMERO</sql>
    </rollback>
  </changeSet>

</databaseChangeLog>
